<!DOCTYPE html>
<html lang="en">

  <head>
      <meta charset="UTF-8" />
      <title>Dashboard Setup</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='home/assets/img/logos/logo-r.png')}}">
      <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='home/assets/img/logos/logo-r.png')}}">
      <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='home/assets/img/logos/logo-r.png')}}">
      <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='home/assets/img/logos/logo-r.png')}}">
      <link rel="manifest" href="{{ url_for('static', filename='home/assets/img/favicons/manifest.json')}}">
      <meta name="msapplication-TileImage" content="{{ url_for('static', filename='home/assets/img/favicons/mstile-150x150.png')}}">
      <meta name="theme-color" content="#ffffff">
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="{{ url_for('static', filename='home/assets/css/create-business.css')}}">
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&amp;family=Rubik:ital,wght@0,300..900;1,300..900family=Rubik:ital,wght@0,300..900;1,300..900&amp;display=swap" rel="stylesheet">
      <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/line.css">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>

  <body>

    <div class="setup-container">

      <!-- LEFT PANEL -->
      <section class="setup-hero">
        <div class="overlay"></div>
        <div class="hero-content">
          <h1>
            Build your<br>
            <span>personalized dashboard</span>
          </h1>
          <p>
            Add your products, revenue sources and expenses.
            We transform your data into a clear financial vision.
          </p>
        </div>
      </section>

      <!-- RIGHT PANEL -->
      <section class="setup-form glass">

        <h2><img src="{{ url_for('static', filename='home/assets/img/logos/fluxa-w.png')}}" alt="logo-business" width="200px"/></h2>
        <p class="subtitle">Tell us how your business works</p>

        <form id="business-form" action="/authentication/business" method="POST">
          <input type="hidden" name="subscription_plan_id" value="{{ selected_plan.id if selected_plan }}">

          <!-- ENTERPRISE CONTEXT -->
          <div class="form-section">
            <h3>Professional Information</h3>

            <input type="text" name="company_name" placeholder="Company Name" required>
            <input type="text" name="company_address" placeholder="Address" required>

            {% set sizes = ["personal", "small", "medium", "large"] %}

            <select name="business_size" required>
              <option value="">Business Size</option>

              {% for size in sizes %}

                  {% set show = true %}

                  {% if selected_plan %}
                      
                      {% if selected_plan.min_business_size and
                            sizes.index(size) < sizes.index(selected_plan.min_business_size) %}
                          {% set show = false %}
                      {% endif %}

                      {% if selected_plan.max_business_size and
                            sizes.index(size) > sizes.index(selected_plan.max_business_size) %}
                          {% set show = false %}
                      {% endif %}

                  {% endif %}

                  {% if show %}
                      <option value="{{ size }}">
                          {% if size == "personal" %}
                              Personal / Individual Business
                          {% elif size == "small" %}
                              Small Business
                          {% elif size == "medium" %}
                              Medium Enterprise
                          {% elif size == "large" %}
                              Large Enterprise
                          {% endif %}
                      </option>
                  {% endif %}

              {% endfor %}
            </select>

            <select name="legal_structure" required>
              <option value="">Legal Structure</option>

              {% if selected_plan and selected_plan.allowed_legal_structures %}
                  {% set allowed = selected_plan.allowed_legal_structures.split(',') %}
                  {% for value in allowed %}
                      <option value="{{ value.strip() }}">
                          {{ value.strip()|upper }}
                      </option>
                  {% endfor %}
              {% else %}
                  <option value="individual">Individual</option>
                  <option value="ets">ETS</option>
                  <option value="sarl">SARL / LLC</option>
                  <option value="sa">SA</option>
                  <option value="ngo">NGO</option>
                  <option value="other">Other</option>
              {% endif %}
            </select>

            <select name="industry" required>
              <option value="">Industry / Sector</option>

              {% if selected_plan and selected_plan.allowed_industries %}
                  {% set allowed = selected_plan.allowed_industries.split(',') %}
                  {% for value in allowed %}
                      <option value="{{ value.strip() }}">
                          {{ value.strip()|capitalize }}
                      </option>
                  {% endfor %}
              {% else %}
                  <option value="retail">Retail</option>
                  <option value="services">Services</option>
                  <option value="manufacturing">Manufacturing</option>
                  <option value="technology">Technology</option>
                  <option value="health">Health</option>
                  <option value="education">Education</option>
                  <option value="agriculture">Agriculture</option>
                  <option value="other">Other</option>
              {% endif %}
            </select>

            <select name="currency" required>
              <option value="">Select Currency</option>
              <option value="USD">USD</option>
              <option value="CDF">CDF</option>
            </select>

            <select name="report_period" required>
              <option value="">Reporting Period</option>
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
            </select>

            <input type="text" name="main_sales_point" placeholder="Main Sales Point (e.g. Head Office)" required>
          </div>

          <!-- PRODUCTS / INVENTORY -->
          <div class="form-section" id="products-section">
            <h3>Products (Initial Inventory)</h3>

            <input type="text" name="product_name[]" placeholder="Product name">
            <input type="number" name="product_price[]" placeholder="Unit Price" min="0">
            <input type="number" name="product_quantity[]" placeholder="Initial Stock Quantity" min="0">

            <select name="product_category[]">
              <option value="">Select Category</option>
              <option value="Food">Food</option>
              <option value="Electronics">Electronics</option>
              <option value="Clothing">Clothing</option>
              <option value="Cosmetics">Cosmetics</option>
              <option value="Home & Decor">Home & Decor</option>
              <option value="Wellness & Health">Wellness & Health</option>
              <option value="Sport & Leisure">Sport & Leisure</option>
              <option value="Toys & Games">Toys & Games</option>
              <option value="Automotive">Automotive</option>
            </select>

            <button type="button" class="add-btn" id="add-product">
              + Add product
            </button>
          </div>

          <!-- REVENUE SOURCES -->
          <div class="form-section" id="revenue-section">
            <h3>Revenue Sources (Estimated)</h3>

            <input type="text" name="revenue_source[]" placeholder="Source name (e.g. POS Sales)">
            <input type="number" name="revenue_amount[]" placeholder="Estimated Amount" min="0">

            <button type="button" class="add-btn" id="add-revenue">
              + Add source
            </button>
          </div>

          <!-- EXPENSES -->
          <div class="form-section" id="expenses-section">
            <h3>Expenses (Estimated)</h3>

            <input type="text" name="expense_name[]" placeholder="Expense name">
            <input type="number" name="expense_cost[]" placeholder="Estimated Cost" min="0">

            <button type="button" class="add-btn" id="add-expense">
              + Add expense
            </button>
          </div>

          <!-- LIABILITIES --> 
          <div class="form-section" id="liabilities-section"> 
            <h3>Liabilities (Debts & Loans)</h3> 
            <input type="text" name="liability_name[]" placeholder="Liability name (e.g. Bank Loan)">
            <input type="number" name="liability_value[]" placeholder="Amount" min="0"> 
            <select name="liability_type[]"> 
              <option value="">Select Type</option> 
              <option value="debt">Debt (Supplier)</option> 
              <option value="loan">Loan (Bank)</option> 
              <option value="other">Other</option> 
            </select> 
            <button type="button" class="add-btn" id="add-liability"> + Add liability </button>
          </div>

          <!-- SYSTEM META (HIDDEN BUT CRITICAL) -->
          <input type="hidden" name="action_type" value="Initial Setup">
          <input type="hidden" name="created_at" id="created_at">

          <button class="primary-btn">
            Generate Dashboard
          </button>

        </form>

        <footer>
          <span>© 2026 Fluxa • Secure & Private</span>
        </footer>

      </section>

    </div>

    <!-- Container des toasts -->
    <div aria-live="polite" aria-atomic="true" class="position-fixed top-0 end-0 p-3" style="z-index: 1080;">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="toast align-items-center text-bg-{{ category }} border-0 mb-2" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000">
              <div class="d-flex">
                <div class="toast-body">
                  {% if category == 'success' %}
                    ✅ {{ message }}
                  {% elif category == 'danger' %}
                    ❌ {{ message }}
                  {% elif category == 'warning' %}
                    ⚠️ {{ message }}
                  {% elif category == 'info' %}
                    ℹ️ {{ message }}
                  {% else %}
                    {{ message }}
                  {% endif %}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
              </div>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}
    </div>

    <script src="{{ url_for('static', filename='home/assets/js/create-business.js')}}"></script>
    <script src="{{ url_for('static', filename='home/assets/js/toast.js')}}"></script>
    
  </body>

</html>
